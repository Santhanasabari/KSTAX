<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GST Registration Auto-Fill</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
    body {
      background-color: #f4f7fc;
      font-family: 'Poppins', sans-serif;
      padding: 2rem;
    }
    .registration-container {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      animation: fadeIn 0.6s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .upload-section {
      background: #f8f9fa;
      padding: 3rem 2rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .upload-section h3 {
      font-weight: 600;
      color: #212529;
    }
    .upload-section p {
      color: #6c757d;
    }
    .form-section {
      padding: 2.5rem;
    }
    .form-control:focus, .form-control:active {
      border-color: #f5c2c7; /* Red focus border */
      box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25); /* Red focus shadow */
    }
    .loader {
      display: none; /* Hidden by default */
    }
    .btn-danger {
      padding: 0.75rem;
    }
    hr {
      margin: 1.5rem 0;
    }
    @media (max-width: 991px) {
      .upload-section { border-bottom: 1px solid #dee2e6; }
      .form-section { padding: 1.5rem; }
    }
</style>
</head>
<body>

<div class="container">
  <div class="registration-container">
    <div class="row g-0">
      
      <!-- Left Upload Section -->
      <div class="col-lg-5 upload-section">
        <div class="mb-4">
          <i class="bi bi-file-earmark-pdf-fill text-danger" style="font-size: 4rem;"></i>
        </div>
        <h3>GST Registration Auto-Fill</h3>
        <p class="mb-4">Upload your GST Certificate PDF to automatically fill the registration form.</p>
        
        <label for="pdf-file" class="form-label visually-hidden">Upload GST Certificate PDF</label>
        <input id="pdf-file" type="file" class="form-control mb-3" accept="application/pdf">

        <button class="btn btn-danger d-flex align-items-center justify-content-center gap-2" id="extractBtn">
          <span class="spinner-border spinner-border-sm loader" role="status" aria-hidden="true"></span>
          <span>Extract & Fill Form</span>
        </button>
        
        <p class="text-muted small mt-3 mb-0">Your data is processed securely on your device.</p>
      </div>

      <!-- Right Form Section -->
      <div class="col-lg-7 form-section">
        <h4 class="mb-4">Create Your Account</h4>
        <form id="regForm">
          <div class="row">
            <h5 class="h6 text-muted">Business Details</h5>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Registration Number (GSTIN)</label>
              <input id="gstin" class="form-control" required>
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Legal Name</label>
              <input id="legalName" class="form-control" required>
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Trade Name</label>
              <input id="tradeName" class="form-control">
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Constitution of Business</label>
              <input id="constitution" class="form-control">
            </div>

            <hr>
            <h5 class="h6 text-muted">Login Credentials & Contact</h5>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Email</label>
              <input id="email" type="email" class="form-control" required>
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Phone Number</label>
              <input id="phone" class="form-control" maxlength="10" required>
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Password</label>
              <input id="password" type="password" class="form-control" required>
            </div>
            <div class="col-md-6 mb-2">
              <label class="form-label small">Confirm Password</label>
              <input id="confirmPassword" type="password" class="form-control" required>
              <small class="text-danger d-none" id="passError">Passwords do not match!</small>
            </div>

            <div class="col-12 mt-3">
              <button type="button" class="btn btn-dark w-100" id="submitBtn">Create Account</button>
            </div>
          </div>
        </form>
        <div id="msg" class="mt-3"></div>
      </div>

    </div>
  </div>
</div>

<!-- PDF Library -->
<script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';

async function loadPDF(source){ return await pdfjsLib.getDocument(source).promise; }

async function readText(pdf){
  let text = "";
  for(let i=1; i<=pdf.numPages; i++){
    let page = await pdf.getPage(i);
    let content = await page.getTextContent();
    text += content.items.map(item => item.str).join(" ") + " ";
  }
  return text;
}

function parseData(txt){
  const find = (reg) => { let m = txt.match(reg); return m ? m[1].trim() : ""; };
  return {
    gstin: find(/GSTIN\s*:?[\s]*([0-9A-Z]{15})/i),
    legal: find(/Legal Name of Business\s*:?\s*(.*?)\s*Trade Name/i),
    trade: find(/Trade Name, if any\s*:?\s*(.*?)\s*Constitution/i),
    constitution: find(/Constitution of Business\s*:?\s*(.*?)\s*Address/i),
    email: find(/E-mail\s*:?\s*([^ \n]+)/i),
  };
}

function fillForm(data){
  document.getElementById("gstin").value = data.gstin;
  document.getElementById("legalName").value = data.legal;
  document.getElementById("tradeName").value = data.trade;
  document.getElementById("constitution").value = data.constitution;
  document.getElementById("email").value = data.email;
}

const extractBtn = document.getElementById("extractBtn");
const loader = extractBtn.querySelector(".loader");
const pdfFile = document.getElementById("pdf-file");

extractBtn.onclick = async () => {
  if (!pdfFile.files[0]) return alert("Please select a PDF file first.");
  
  loader.style.display = 'inline-block'; // Show loader
  extractBtn.disabled = true;

  try {
    const file = pdfFile.files[0];
    const pdf = await loadPDF(await file.arrayBuffer());
    const text = await readText(pdf);
    const data = parseData(text);
    fillForm(data);
  } catch (err) {
    console.error("PDF processing failed:", err);
    alert("Could not process the PDF. Please ensure it is a valid GST certificate.");
  } finally {
    loader.style.display = 'none'; // Hide loader
    extractBtn.disabled = false;
  }
};

document.getElementById("confirmPassword").onkeyup = () => {
  const pass = document.getElementById("password").value;
  const confirmPass = document.getElementById("confirmPassword").value;
  document.getElementById("passError").classList.toggle("d-none", pass === confirmPass);
};

document.getElementById("submitBtn").onclick = () => {
  document.getElementById("msg").innerHTML = 
    `<div class='alert alert-success'>âœ” Registration Successfully Completed!</div>`;
};
</script>

</body>
</html>
