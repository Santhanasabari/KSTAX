<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GST Registration Auto-Fill</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
    body {
      background-color: #f4f7fc;
      font-family: 'Poppins', sans-serif;
      padding: 2rem;
    }
    .main-container {
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      animation: fadeIn 0.6s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .upload-section {
      background: #f8f9fa;
      padding: 3rem 2.5rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .upload-section h3 {
      font-weight: 600;
      color: #dc3545; /* Red title */
    }
    .upload-section p {
      color: #6c757d;
    }
    .form-section {
      padding: 2.5rem;
    }
    .form-control:focus, .form-control:active {
      border-color: #f5c2c7;
      box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
    }
    .form-section-title {
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #eee;
    }
    .h5-green {
        color: #198754;
    }
    .hide { display: none; }
    /* --- Photo Preview Style --- */
    #photoPreview {
        max-width: 120px;
        height: auto;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
        margin-top: 0.75rem;
    }
    .input-group-text {
        cursor: pointer;
    }
    @media (max-width: 991px) {
      .upload-section { border-bottom: 1px solid #dee2e6; }
      .form-section { padding: 1.5rem; }
    }
</style>
</head>
<body>

<div class="container">
  <div class="main-container">
    <div class="row g-0">
      
      <!-- Left Upload Section -->
      <div class="col-lg-5 upload-section">
        <div class="mb-4">
          <i class="bi bi-file-earmark-pdf-fill text-danger" style="font-size: 4rem;"></i>
        </div>
        <h3>GST Registration Auto-Fill</h3>
        <p class="mb-4">Upload your GST Certificate PDF to automatically populate the registration form.</p>
        
        <label for="pdf-file" class="form-label visually-hidden">Upload GST Certificate</label>
        <input id="pdf-file" type="file" class="form-control mb-3" accept="application/pdf">

        <button class="btn btn-danger d-flex align-items-center justify-content-center gap-2 mb-2" id="extractBtn">
          <span>Extract & Fill Form</span>
        </button>
        <button class="btn btn-outline-secondary d-flex align-items-center justify-content-center gap-2" id="loadServerBtn">
          <span>Use Sample PDF</span>
        </button>
        
        <p class="text-muted small mt-3 mb-0">Your data is processed securely in your browser.</p>
      </div>

      <!-- Right Form Section -->
      <div class="col-lg-7 form-section">
        <h4 class="mb-4">Create Your Account</h4>
        <form id="regForm">
          <div class="row">
            <h5 class="form-section-title">Business Details</h5>
            <div class="col-md-6 mb-3">
              <label class="form-label small">Registration Number (GSTIN)</label>
              <input id="gstin" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label small">Legal Name</label>
              <input id="legalName" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label small">Trade Name</label>
              <input id="tradeName" class="form-control">
            </div>
            <div class="col-md-12 mb-3">
              <label class="form-label small">Address of Principal Place of Business</label>
              <textarea id="address" class="form-control" rows="3"></textarea>
            </div>

            <h5 class="form-section-title mt-2">Profile Photo</h5>
            <div class="col-12 mb-3">
                <label for="photoUpload" class="form-label small">Upload Your Photo</label>
                <input class="form-control" type="file" id="photoUpload" accept="image/*">
                <img id="photoPreview" class="hide" alt="Photo Preview">
            </div>

            <h5 class="form-section-title mt-2 h5-green">Login Credentials & Contact</h5>
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Email</label>
              <input id="email" type="email" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label small fw-bold">Username</label>
                <input id="username" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Password</label>
              <div class="input-group">
                <span class="input-group-text">
                  <i class="bi bi-lock-fill"></i>
                </span>
                <input id="password" type="password" class="form-control" required>
                <span class="input-group-text" id="togglePassword">
                  <i class="bi bi-eye-slash-fill"></i>
                </span>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label small fw-bold">Confirm Password</label>
              <div class="input-group">
                  <span class="input-group-text">
                    <i class="bi bi-lock-fill"></i>
                  </span>
                  <input id="confirmPassword" type="password" class="form-control" required>
                  <span class="input-group-text" id="toggleConfirmPassword">
                    <i class="bi bi-eye-slash-fill"></i>
                  </span>
              </div>
              <small class="text-danger hide" id="passError">Passwords do not match!</small>
            </div>

            <!-- Phone Number & OTP Section Moved Down -->
            <div class="col-md-6 mb-3">
                <label class="form-label small fw-bold">Phone Number</label>
                <input id="phone" class="form-control" maxlength="10" required placeholder="e.g., 9876543210">
            </div>
            <div class="col-md-6 mb-3">
                <button type="button" class="btn btn-outline-danger w-100 mt-4" id="sendOtpBtn">Send OTP</button>
            </div>

            <div id="otpSection" class="col-12 row g-3 align-items-center hide mt-1">
                <div class="col-md-6">
                    <input class="form-control" id="otpInput" placeholder="Enter 6-Digit OTP" maxlength="6">
                </div>
                <div class="col-md-6">
                    <button type="button" class="btn btn-danger" id="verifyOtpBtn">Verify OTP</button>
                </div>
                <small id="otpMsg" class="ms-2"></small>
            </div>

            <div class="col-12 mt-4">
              <button type="button" class="btn btn-dark w-100 py-2 hide" id="submitBtn">Create Account</button>
            </div>
          </div>
        </form>
        <div id="msg" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<!-- PDF Library -->
<script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js';

let OTP="";

async function loadPDF(source) { return await pdfjsLib.getDocument(source).promise; }

async function readText(pdf) {
    let text = "";
    for (let i = 1; i <= pdf.numPages; i++) {
        let page = await pdf.getPage(i);
        let content = await page.getTextContent();
        text += content.items.map(item => item.str).join(" ") + " ";
    }
    return text;
}

function parseData(txt) {
    // Updated helper function to find a match and clean up whitespace.
    const find = (reg) => { 
        const match = txt.match(reg); 
        // If a match is found, trim it and replace multiple spaces/newlines with a single space.
        return match ? match[1].trim().replace(/\s+/g, ' ') : ""; 
    };
    return {
        gstin: find(/GSTIN\s*:?\s*([0-9A-Z]{15})/i),
        // This regex is now more robust. It captures everything (including newlines) 
        // between "Legal Name of Business" and the next known field "Trade Name, if any".
        legal: find(/Legal Name of Business\s*:?\s*([\s\S]*?)\s*Trade Name, if any/i),
        trade: find(/Trade Name, if any\s*:?\s*(.*?)(?:\s{2,}|Constitution)/i),
        // New logic to capture the full address.
        address: find(/Address of Principal Place of Business\s*:?\s*([\s\S]*?)\s*(?:Details of Additional Places|Date of Registration)/i),
        email: find(/E-mail\s*:?\s*([^ \n]+)/i),
    };
}

function fillForm(data) {
    document.getElementById("gstin").value = data.gstin;
    document.getElementById("legalName").value = data.legal;
    document.getElementById("tradeName").value = data.trade;
    document.getElementById("address").value = data.address;
    document.getElementById("email").value = data.email;
}

async function processPdf(fileSource, isUrl = false) {
    try {
        const pdf = isUrl ? await loadPDF(fileSource) : await loadPDF(await fileSource.arrayBuffer());
        const text = await readText(pdf);
        const data = parseData(text);
        fillForm(data);
    } catch (err) {
        console.error("PDF processing failed:", err);
        alert("Could not process the PDF. Please ensure it is a valid GST certificate.");
    }
}

document.getElementById("extractBtn").onclick = async () => {
    const file = document.getElementById("pdf-file").files[0];
    if (!file) return alert("Please select a PDF file first.");
    processPdf(file);
};

// --- New: Password Toggle Logic ---
const togglePassword = document.querySelector("#togglePassword");
const password = document.querySelector("#password");
const toggleConfirmPassword = document.querySelector("#toggleConfirmPassword");
const confirmPassword = document.querySelector("#confirmPassword");

if (togglePassword) {
    togglePassword.addEventListener("click", function () {
        const type = password.getAttribute("type") === "password" ? "text" : "password";
        password.setAttribute("type", type);
        this.querySelector("i").classList.toggle("bi-eye-fill");
        this.querySelector("i").classList.toggle("bi-eye-slash-fill");
    });
}

if (toggleConfirmPassword) {
    toggleConfirmPassword.addEventListener("click", function () {
        const type = confirmPassword.getAttribute("type") === "password" ? "text" : "password";
        confirmPassword.setAttribute("type", type);
        this.querySelector("i").classList.toggle("bi-eye-fill");
        this.querySelector("i").classList.toggle("bi-eye-slash-fill");
    });
}

// --- New: Photo Preview Logic ---
document.getElementById("photoUpload").onchange = (event) => {
    const preview = document.getElementById("photoPreview");
    const file = event.target.files[0];
    if (file) {
        preview.src = URL.createObjectURL(file);
        preview.classList.remove("hide");
    } else {
        preview.classList.add("hide");
    }
};

document.getElementById("loadServerBtn").onclick = () => {
    // This path is for demonstration. Replace with an actual URL if needed.
    alert("This feature is for demonstration and will load a sample file.");
    // processPdf('/path/to/your/sample.pdf', true);
};

document.getElementById("confirmPassword").onkeyup = () => {
    const pass = document.getElementById("password").value;
    const confirmPass = document.getElementById("confirmPassword").value;
    document.getElementById("passError").classList.toggle("hide", pass === confirmPass);
};

document.getElementById("sendOtpBtn").onclick = () => {
    const phone = document.getElementById("phone").value;
    if (phone.length !== 10) return alert("Please enter a valid 10-digit phone number.");
    OTP = Math.floor(100000 + Math.random() * 900000).toString();
    document.getElementById("otpSection").classList.remove("hide");
    document.getElementById("otpMsg").textContent = "Demo OTP Sent: " + OTP;
};

document.getElementById("verifyOtpBtn").onclick = () => {
    const otpMsg = document.getElementById("otpMsg");
    if (document.getElementById("otpInput").value === OTP) {
        otpMsg.textContent = "✔ OTP Verified Successfully!";
        otpMsg.className = 'text-success ms-2';
        document.getElementById("submitBtn").classList.remove("hide");
    } else {
        otpMsg.textContent = "❌ Incorrect OTP. Please try again.";
        otpMsg.className = 'text-danger ms-2';
    }
};

document.getElementById("submitBtn").onclick = () => {
    document.getElementById("msg").innerHTML = 
    `<div class='alert alert-success'>✔ Registration Successfully Completed!</div>`;
};
</script>

</body>
</html>
