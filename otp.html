<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Payment Options — Card / Netbanking / UPI + QR + Mobile OTP (Demo)</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- QR Code library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body { background:#f4f7ff; font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .card { border-radius:12px; box-shadow:0 10px 30px rgba(11,35,73,0.06); }
    .otp-input { width:3.2rem; height:3.2rem; text-align:center; font-size:1.2rem; border-radius:8px; }
    .qr-box { width:200px; height:200px; margin:auto; }
    @media (max-width:480px){ .qr-box{ width:170px; height:170px } .otp-input{ width:2.6rem; height:2.6rem } }
  </style>
</head>
<body>

<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card p-4">

        <h3 class="mb-3">Pay — Choose Method</h3>

        <div class="mb-3">
          <div class="d-flex justify-content-between">
            <div>
              <div class="small text-muted">Invoice</div>
              <strong>GST Filing Service</strong>
            </div>
            <div>
              <div class="small text-muted">Amount</div>
              <strong>₹ <span id="payAmount">2499.00</span></strong>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Choose payment method</label>
          <select id="method" class="form-select">
            <option value="card">Card</option>
            <option value="netbank">Netbanking</option>
            <option value="upi">UPI (VPA / QR)</option>
            <option value="mobile">Mobile OTP</option>
          </select>
        </div>

        <!-- CARD -->
        <div id="cardBlock" class="method-block">
          <div class="mb-2 small text-muted">Card payment (demo). Use test card numbers in production gateway sandbox.</div>
          <div class="row g-2">
            <div class="col-8">
              <label class="form-label">Card number</label>
              <input id="cardNumber" class="form-control" placeholder="4242 4242 4242 4242" inputmode="numeric" maxlength="19">
            </div>
            <div class="col-4">
              <label class="form-label">Expiry (MM/YY)</label>
              <input id="cardExpiry" class="form-control" placeholder="08/27" maxlength="5">
            </div>
            <div class="col-6">
              <label class="form-label">Name on card</label>
              <input id="cardName" class="form-control" placeholder="Full name">
            </div>
            <div class="col-3">
              <label class="form-label">CVV</label>
              <input id="cardCVV" class="form-control" placeholder="123" maxlength="4" inputmode="numeric">
            </div>
            <div class="col-3 d-flex align-items-end">
              <button id="cardPayBtn" class="btn btn-primary w-100">Pay ₹ <span id="cardAmt">2499</span></button>
            </div>
          </div>
          <small class="text-muted mt-2 d-block">In production: call payment gateway tokenization & charge API (Razorpay/Stripe/PayU/Cashfree).</small>
        </div>

        <!-- NETBANKING -->
        <div id="netbankBlock" class="method-block" style="display:none;">
          <label class="form-label">Choose Bank</label>
          <select id="bankSelect" class="form-select mb-2">
            <option value="HDFC">HDFC Bank</option>
            <option value="ICICI">ICICI Bank</option>
            <option value="SBI">State Bank of India</option>
            <option value="AXIS">Axis Bank</option>
            <option value="PNB">PNB</option>
          </select>
          <div class="d-flex gap-2">
            <button id="netbankPayBtn" class="btn btn-primary">Pay via Netbanking</button>
            <button id="netbankSimBtn" class="btn btn-outline-secondary">Simulate redirect</button>
          </div>
          <small class="text-muted d-block mt-2">In real flow, redirect to selected bank's netbanking gateway or use payment provider's netbanking flow.</small>
        </div>

        <!-- UPI -->
        <div id="upiBlock" class="method-block" style="display:none;">
          <div class="mb-2 small text-muted">Enter UPI ID (VPA) or generate UPI QR (scannable).</div>
          <div class="row g-2">
            <div class="col-md-7">
              <label class="form-label">UPI ID (VPA) — e.g., merchant@upi</label>
              <input id="vpaInput" class="form-control" placeholder="merchant@bank">
            </div>
            <div class="col-md-5 d-flex align-items-end">
              <button id="genQrBtn" class="btn btn-outline-primary w-100">Generate QR</button>
            </div>
          </div>

          <div class="text-center mt-3">
            <div id="qrWrap" class="qr-box"></div>
            <div id="upiUri" class="small text-muted mt-2"></div>
            <div class="d-flex justify-content-center gap-2 mt-2">
              <button id="upiOpenBtn" class="btn btn-success">Open UPI App</button>
              <button id="downloadQrBtn" class="btn btn-outline-secondary">Download QR</button>
            </div>
            <div class="mt-2 small text-muted">UPI deep-link opens apps on mobile. On desktop, it may show an error if no app handles `upi://` scheme.</div>
          </div>
        </div>

        <!-- MOBILE OTP -->
        <div id="mobileBlock" class="method-block" style="display:none;">
          <div class="mb-2 small text-muted">Verify mobile with OTP and then complete payment.</div>
          <div class="input-group mb-2">
            <span class="input-group-text">+91</span>
            <input id="mobileInput" type="tel" class="form-control" placeholder="9XXXXXXXXX" maxlength="10" inputmode="numeric">
            <button id="sendOtpBtn" class="btn btn-primary">Send OTP</button>
          </div>

          <div id="otpArea" style="display:none;">
            <div class="small text-muted mb-2">OTP sent to <span id="maskedMobile">9XXXXX123</span></div>
            <div class="d-flex gap-2 mb-2 justify-content-center">
              <input class="otp-input form-control" maxlength="1" inputmode="numeric" />
              <input class="otp-input form-control" maxlength="1" inputmode="numeric" />
              <input class="otp-input form-control" maxlength="1" inputmode="numeric" />
              <input class="otp-input form-control" maxlength="1" inputmode="numeric" />
              <input class="otp-input form-control" maxlength="1" inputmode="numeric" />
              <input class="otp-input form-control" maxlength="1" inputmode="numeric" />
            </div>

            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <button id="verifyOtpBtn" class="btn btn-success">Verify & Pay ₹ <span id="otpAmt">2499</span></button>
              </div>
              <div class="text-end small text-muted">
                <div id="timerText">00:30</div>
                <button id="resendOtpBtn" class="btn btn-link p-0" disabled>Resend</button>
              </div>
            </div>

            <div id="otpMessage" class="small text-danger"></div>
          </div>
        </div>

        <hr>
        <div id="statusArea" style="display:none;">
          <div id="statusMsg" class="alert"></div>
        </div>

        <div class="small text-muted">This page is a demo. Integrate with real payment & SMS gateway on server for production.</div>

      </div>
    </div>
  </div>
</div>

<script>
/* -------------------------
  Helpers & State
  ------------------------- */
const method = document.getElementById('method');
const blocks = { card: document.getElementById('cardBlock'), netbank: document.getElementById('netbankBlock'), upi: document.getElementById('upiBlock'), mobile: document.getElementById('mobileBlock') };
const amount = parseFloat(document.getElementById('payAmount').textContent || '2499');
document.getElementById('cardAmt').textContent = amount;

function showBlock(name){
  Object.keys(blocks).forEach(k => blocks[k].style.display = (k===name ? 'block':'none'));
  clearStatus();
}

/* method change */
method.addEventListener('change', ()=> showBlock(method.value));
showBlock('card'); // default

/* -------------------------
  CARD: basic validation + simulate payment
  ------------------------- */
document.getElementById('cardPayBtn').addEventListener('click', (e)=>{
  e.preventDefault();
  const num = (document.getElementById('cardNumber').value || '').replace(/\s+/g,'');
  const exp = document.getElementById('cardExpiry').value || '';
  const name = document.getElementById('cardName').value || '';
  const cvv = document.getElementById('cardCVV').value || '';

  // simple validation
  if(!/^\d{12,19}$/.test(num)){ return showStatus('Enter valid card number','danger'); }
  if(!/^\d{2}\/\d{2}$/.test(exp)){ return showStatus('Enter expiry as MM/YY','danger'); }
  if(name.trim().length < 2){ return showStatus('Enter name on card','danger'); }
  if(!/^\d{3,4}$/.test(cvv)){ return showStatus('Enter valid CVV','danger'); }

  // In production: send card details to gateway tokenization endpoint (never send raw card to your server unless PCI compliant)
  showStatus('Processing card payment...', 'info');
  setTimeout(()=> {
    showStatus(`Payment successful (demo). Transaction ID: CARD${Date.now()}`, 'success');
  }, 1400);
});

/* -------------------------
  NETBANKING: simulate redirect
  ------------------------- */
document.getElementById('netbankPayBtn').addEventListener('click', (e)=>{
  e.preventDefault();
  const bank = document.getElementById('bankSelect').value;
  // In production: call server to create netbanking order & redirect to bank/payment provider.
  showStatus('Redirecting to ' + bank + ' netbanking (simulated)...', 'info');
  setTimeout(()=> showStatus(`Payment completed via ${bank} (simulated). TXN: NB${Date.now()}`, 'success'), 1600);
});

document.getElementById('netbankSimBtn').addEventListener('click', ()=>{
  const bank = document.getElementById('bankSelect').value;
  window.open('about:blank','_blank').document.write(`<p style="font-family:Arial">Simulated redirect to ${bank} netbanking.<br>In production, you would be redirected to bank/payment provider.</p>`);
});

/* -------------------------
  UPI: Generate UPI URI + QR + open deep link
  ------------------------- */
let qrcode = null;
const qrWrap = document.getElementById('qrWrap');
const genQrBtn = document.getElementById('genQrBtn');
const vpaInput = document.getElementById('vpaInput');
const upiUriText = document.getElementById('upiUri');
const upiOpenBtn = document.getElementById('upiOpenBtn');
const downloadQrBtn = document.getElementById('downloadQrBtn');

function createUpiUri(vpa){
  // Required fields per NPCI UPI deep link (common): pa, pn, am, tr, tn, cu
  const pa = encodeURIComponent(vpa);
  const pn = encodeURIComponent('GST Filing Service');
  const am = encodeURIComponent(String(amount));
  const tr = encodeURIComponent('TXN'+Date.now());
  const tn = encodeURIComponent('Payment for GST Filing');
  const cu = 'INR';
  return `upi://pay?pa=${pa}&pn=${pn}&am=${am}&tr=${tr}&tn=${tn}&cu=${cu}`;
}

genQrBtn.addEventListener('click', ()=>{
  clearStatus();
  const vpa = (vpaInput.value || '').trim();
  if(!vpa || !/^[^@]+@[^@]+$/.test(vpa)){
    return showStatus('Enter valid UPI ID (like merchant@bank).', 'danger');
  }
  const uri = createUpiUri(vpa);
  // show URI text
  upiUriText.textContent = uri;

  // generate QR
  qrWrap.innerHTML = '';
  qrcode = new QRCode(qrWrap, { text: uri, width: 200, height: 200, correctLevel: QRCode.CorrectLevel.H });
  showStatus('QR generated. Scan with UPI app or click "Open UPI App".', 'success');
});

// open UPI apps (deep link)
upiOpenBtn.addEventListener('click', ()=>{
  const vpa = (vpaInput.value || '').trim();
  if(!vpa) return showStatus('Enter UPI ID and generate QR first.', 'danger');
  const uri = createUpiUri(vpa);
  // Attempt to open UPI URI — on mobile will open UPI apps
  window.location.href = uri;
  // In many desktop browsers, this will show error if no handler. That's expected.
});

// download QR as PNG
downloadQrBtn.addEventListener('click', ()=>{
  if(!qrWrap.querySelector('img') && !qrWrap.querySelector('canvas')) {
    return showStatus('Please generate QR first.', 'danger');
  }
  // QRCode.js creates either img or canvas depending on environment
  const img = qrWrap.querySelector('img');
  if(img){
    const url = img.src;
    downloadDataUrl(url, `upi-qr-${Date.now()}.png`);
  } else {
    const canvas = qrWrap.querySelector('canvas');
    const dataUrl = canvas.toDataURL('image/png');
    downloadDataUrl(dataUrl, `upi-qr-${Date.now()}.png`);
  }
});

function downloadDataUrl(dataUrl, filename){
  const a = document.createElement('a');
  a.href = dataUrl;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
}

/* -------------------------
  MOBILE OTP: demo flow (client-side)
  ------------------------- */
let currentOtp = null;
let otpTimer = null;
let otpRemaining = 0;

const sendOtpBtn = document.getElementById('sendOtpBtn');
const mobileInput = document.getElementById('mobileInput');
const otpArea = document.getElementById('otpArea');
const maskedMobile = document.getElementById('maskedMobile');
const verifyOtpBtn = document.getElementById('verifyOtpBtn');
const resendOtpBtn = document.getElementById('resendOtpBtn');
const timerText = document.getElementById('timerText');
const otpMsg = document.getElementById('otpMessage');

sendOtpBtn.addEventListener('click', ()=> {
  clearStatus();
  const m = (mobileInput.value || '').trim();
  if(!/^[6-9]\d{9}$/.test(m)) return showStatus('Enter valid 10-digit Indian mobile number (starts 6-9).', 'danger');
  // Demo: generate OTP here. PRODUCTION: call backend to generate & SEND SMS
  currentOtp = String(Math.floor(100000 + Math.random()*900000));
  console.info('DEMO OTP:', currentOtp);
  // show OTP UI
  maskedMobile.textContent = maskMobile(m);
  otpArea.style.display = 'block';
  otpMsg.textContent = 'OTP sent (demo). Check console.';
  otpMsg.className = 'small text-success';
  startOtpTimer(30);
  clearOtpBoxes();
});

function maskMobile(m){
  return m.slice(0,3) + 'XXXXX' + m.slice(-2);
}
function startOtpTimer(sec=30){
  clearInterval(otpTimer);
  otpRemaining = sec;
  resendOtpBtn.disabled = true;
  updateTimer();
  otpTimer = setInterval(()=> {
    otpRemaining--;
    updateTimer();
    if(otpRemaining<=0){ clearInterval(otpTimer); resendOtpBtn.disabled = false; timerText.textContent='Expired'; }
  },1000);
}
function updateTimer(){ const mm = String(Math.floor(otpRemaining/60)).padStart(2,'0'); const ss=String(otpRemaining%60).padStart(2,'0'); timerText.textContent = `${mm}:${ss}`; }
function clearOtpBoxes(){ document.querySelectorAll('.otp-input').forEach(i=>i.value=''); document.querySelector('.otp-input').focus(); }

resendOtpBtn.addEventListener('click', ()=>{
  if(resendOtpBtn.disabled) return;
  currentOtp = String(Math.floor(100000 + Math.random()*900000));
  console.info('DEMO Resent OTP:', currentOtp);
  startOtpTimer(30);
  otpMsg.textContent = 'OTP resent (demo). Check console.';
  otpMsg.className = 'small text-success';
});

verifyOtpBtn.addEventListener('click', ()=>{
  // collect OTP
  const entered = Array.from(document.querySelectorAll('.otp-input')).map(i=>i.value||'').join('');
  if(entered.length !== 6) return showStatus('Enter full 6-digit OTP.', 'danger');
  if(otpRemaining<=0) return showStatus('OTP expired. Resend and try again.', 'danger');
  if(entered !== currentOtp) return showStatus('Incorrect OTP.', 'danger');
  // success: simulate server-side verify + payment capture
  clearInterval(otpTimer);
  currentOtp = null;
  otpArea.style.display = 'none';
  showStatus(`Payment successful via Mobile OTP (demo). TXN: OTP${Date.now()}`, 'success');
});

/* enable numeric paste & auto-focus for OTP inputs */
const otpBoxes = Array.from(document.querySelectorAll('.otp-input'));
otpBoxes.forEach((b, idx) => {
  b.addEventListener('input', (e)=> {
    const v = e.target.value.replace(/\D/g,'').slice(0,1);
    e.target.value = v;
    if(v && idx < otpBoxes.length - 1) otpBoxes[idx+1].focus();
  });
  b.addEventListener('keydown', (e)=> {
    if(e.key === 'Backspace' && !b.value && idx>0) otpBoxes[idx-1].focus();
  });
  b.addEventListener('paste', (e)=> {
    e.preventDefault();
    const paste = (e.clipboardData||window.clipboardData).getData('text').replace(/\D/g,'').slice(0,6);
    for(let i=0;i<otpBoxes.length;i++) otpBoxes[i].value = paste[i]||'';
  });
});

/* -------------------------
  UI helpers
  ------------------------- */
function showStatus(msg, type='info'){
  const area = document.getElementById('statusArea');
  const el = document.getElementById('statusMsg');
  area.style.display = 'block';
  el.className = `alert alert-${type}`;
  el.innerHTML = msg;
  // Also show in OTP message area if relevant
}
function clearStatus(){ document.getElementById('statusArea').style.display='none'; document.getElementById('statusMsg').innerHTML=''; }

/* -------------------------
  Final notes: in production:
  - Card: use gateway's client tokenization (Stripe Elements, Razorpay checkout).
  - Netbanking: create order on server, redirect to provider.
  - UPI: use gateway's UPI intent or deep-link; or generate QR server-side for stability.
  - OTP: server generates OTP, stores hashed with expiry, sends via SMS provider, server verifies.
  ------------------------- */
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
